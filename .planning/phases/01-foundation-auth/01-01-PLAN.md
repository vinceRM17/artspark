---
phase: 01-foundation-auth
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - package-lock.json
  - app.json
  - tsconfig.json
  - tailwind.config.js
  - metro.config.js
  - babel.config.js
  - global.css
  - lib/supabase.ts
  - .env.local
  - .gitignore
autonomous: false

must_haves:
  truths:
    - "Expo project runs on iOS simulator without errors"
    - "Expo project runs on Android emulator without errors"
    - "Supabase client successfully connects to remote instance"
    - "Environment variables load correctly in development"
  artifacts:
    - path: "package.json"
      provides: "Project dependencies and scripts"
      contains: "expo"
    - path: "app.json"
      provides: "Expo configuration with app scheme"
      contains: "scheme"
    - path: "lib/supabase.ts"
      provides: "Supabase client singleton"
      exports: ["supabase"]
    - path: "tailwind.config.js"
      provides: "NativeWind v4 styling configuration"
      contains: "nativewind/preset"
  key_links:
    - from: "lib/supabase.ts"
      to: "process.env.EXPO_PUBLIC_SUPABASE_URL"
      via: "environment variable import"
      pattern: "EXPO_PUBLIC_SUPABASE_URL"
    - from: "app.json"
      to: "expo-router"
      via: "plugin configuration"
      pattern: "expo-router"

user_setup:
  - service: supabase
    why: "Backend authentication and database"
    account_setup:
      - task: "Create free Supabase account"
        url: "https://supabase.com"
      - task: "Create new project (choose region close to you)"
        location: "Supabase Dashboard"
    env_vars:
      - name: EXPO_PUBLIC_SUPABASE_URL
        source: "Supabase Dashboard -> Settings -> API -> Project URL"
      - name: EXPO_PUBLIC_SUPABASE_ANON_KEY
        source: "Supabase Dashboard -> Settings -> API -> anon/public key"
    dashboard_config: []
---

<objective>
Initialize ArtSpark mobile app with Expo, React Native, and Supabase backend connection.

Purpose: Establish project foundation with all necessary dependencies, configuration files, and backend connectivity to enable authentication implementation in subsequent plans.

Output:
- Runnable Expo project with TypeScript and NativeWind v4 styling
- Configured Supabase client connected to remote instance
- Development environment with proper type checking and linting
</objective>

<execution_context>
@/Users/vincecain/.claude/get-shit-done/workflows/execute-plan.md
@/Users/vincecain/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-auth/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Initialize Expo project with routing and styling</name>
  <files>
    package.json
    package-lock.json
    app.json
    tsconfig.json
    tailwind.config.js
    metro.config.js
    babel.config.js
    global.css
    app/_layout.tsx
    .gitignore
  </files>
  <action>
Create new Expo project using blank TypeScript template with Expo Router and NativeWind v4 styling.

Steps:
1. Run `npx create-expo-app@latest . --template blank-typescript` (use current directory)
2. Install Expo Router core dependencies:
   ```bash
   npx expo install expo-router react-native-safe-area-context react-native-screens expo-linking expo-constants expo-status-bar
   ```
3. Install Supabase dependencies:
   ```bash
   npm install @supabase/supabase-js @react-native-async-storage/async-storage react-native-url-polyfill
   npx expo install expo-secure-store
   ```
4. Install NativeWind v4 styling (NOT v5 preview):
   ```bash
   npm install nativewind@^4.1.0 tailwindcss@^3.4.17 react-native-reanimated
   npx tailwindcss init
   ```
5. Configure tailwind.config.js:
   ```javascript
   module.exports = {
     content: [
       "./app/**/*.{js,jsx,ts,tsx}",
       "./components/**/*.{js,jsx,ts,tsx}"
     ],
     presets: [require("nativewind/preset")],
     theme: {
       extend: {},
     },
     plugins: [],
   }
   ```
6. Configure metro.config.js with NativeWind:
   ```javascript
   const { getDefaultConfig } = require("expo/metro-config");
   const { withNativeWind } = require('nativewind/metro');

   const config = getDefaultConfig(__dirname);

   module.exports = withNativeWind(config, { input: './global.css' });
   ```
7. Configure babel.config.js:
   ```javascript
   module.exports = function(api) {
     api.cache(true);
     return {
       presets: [
         ["babel-preset-expo", { jsxImportSource: "nativewind" }],
         "nativewind/babel",
       ],
     };
   };
   ```
8. Create global.css:
   ```css
   @tailwind base;
   @tailwind components;
   @tailwind utilities;
   ```
9. Update app.json to include Expo Router scheme:
   ```json
   {
     "expo": {
       "scheme": "artspark",
       "plugins": ["expo-router"]
     }
   }
   ```
10. Create app/_layout.tsx root layout:
    ```typescript
    import "../global.css";
    import { Slot } from 'expo-router';

    export default function RootLayout() {
      return <Slot />;
    }
    ```
11. Update .gitignore to include:
    ```
    .env.local
    .env
    ```

IMPORTANT: Use exact versions specified - NativeWind v4.1.0 (not v5), Tailwind CSS v3.4.17, per research recommendations.
  </action>
  <verify>
Run `npx expo start` and verify project launches without errors. Check that:
- TypeScript compilation succeeds
- Metro bundler starts successfully
- No module resolution errors in console
- Opening on iOS simulator or Android emulator shows blank screen (expected - no content yet)
  </verify>
  <done>
Expo project runs successfully on both iOS simulator and Android emulator with TypeScript and NativeWind v4 configured. Package.json contains all required dependencies at correct versions.
  </done>
</task>

<task type="auto">
  <name>Configure Supabase client with session persistence</name>
  <files>
    lib/supabase.ts
    .env.local
  </files>
  <action>
Create Supabase client singleton configured for React Native with AsyncStorage session persistence.

Note: User must create Supabase project and provide credentials (execute-plan will prompt for this).

Steps:
1. Create .env.local template with placeholder values:
   ```
   EXPO_PUBLIC_SUPABASE_URL=your-project-url
   EXPO_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
   ```
2. Create lib/supabase.ts:
   ```typescript
   import 'react-native-url-polyfill/auto';
   import { createClient } from '@supabase/supabase-js';
   import AsyncStorage from '@react-native-async-storage/async-storage';

   const supabaseUrl = process.env.EXPO_PUBLIC_SUPABASE_URL;
   const supabaseAnonKey = process.env.EXPO_PUBLIC_SUPABASE_ANON_KEY;

   if (!supabaseUrl || !supabaseAnonKey) {
     throw new Error('Missing Supabase environment variables. Check .env.local file.');
   }

   export const supabase = createClient(supabaseUrl, supabaseAnonKey, {
     auth: {
       storage: AsyncStorage,
       autoRefreshToken: true,
       persistSession: true,
       detectSessionInUrl: false, // Important: disable for React Native
     },
   });
   ```

IMPORTANT:
- Use AsyncStorage (not SecureStore) for Supabase session storage per official docs - Supabase session is encrypted JWT, AsyncStorage is sufficient
- Set detectSessionInUrl: false for React Native (this is web-only)
- Import 'react-native-url-polyfill/auto' at top - required for Supabase JS in React Native
  </action>
  <verify>
After user provides Supabase credentials and updates .env.local:
1. Run `npx expo start --clear`
2. Add temporary test in app/_layout.tsx:
   ```typescript
   import { supabase } from '@/lib/supabase';
   console.log('Supabase client initialized:', !!supabase);
   ```
3. Verify console shows "Supabase client initialized: true" without errors
4. Remove test code after verification
  </verify>
  <done>
Supabase client successfully initializes with user-provided credentials. Environment variables load correctly and client connects to remote Supabase instance without errors.
  </done>
</task>

</tasks>

<verification>
1. Run `npm run type-check` (or `npx tsc --noEmit`) - no TypeScript errors
2. Run `npx expo start` - project launches without errors
3. Open on iOS simulator - app loads with blank screen (expected)
4. Open on Android emulator - app loads with blank screen (expected)
5. Verify lib/supabase.ts imports without errors in app/_layout.tsx
6. Check that global.css styles are available (test by adding className="text-red-500" to a Text component)
</verification>

<success_criteria>
- Expo project structure exists with all required configuration files
- TypeScript compilation succeeds with strict mode enabled
- NativeWind v4 styling system is functional
- Supabase client connects to remote instance using user credentials
- Project runs on both iOS and Android platforms without errors
- Environment variables are properly excluded from version control
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-auth/01-01-SUMMARY.md` documenting:
- Installed dependencies and versions
- Project structure created
- Supabase connection configuration
- Any deviations from plan or issues encountered
- Next steps for Plan 02
</output>
